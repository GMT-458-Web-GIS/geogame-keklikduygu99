<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GeoGame — Turkish Cuisine (35 Provinces)</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
  :root{
    --bg:#0f1624; --card:#0b1220; --accent:#00bcd4; --muted:#9fb6c1;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#071229,#081827);color:#e8f6fb}
  .wrap{max-width:1100px;margin:28px auto;padding:18px}
  .card{background:rgba(255,255,255,0.03);border-radius:12px;padding:14px}
  header{display:flex;justify-content:space-between;align-items:center}
  h1{margin:0;font-size:20px}
  .small{color:var(--muted);font-size:13px}
  button{cursor:pointer;border-radius:8px;padding:10px 14px;border:none;font-weight:700}
  .btn-primary{background:var(--accent);color:#012;box-shadow:0 6px 18px rgba(0,188,212,0.08)}
  .btn-ghost{background:transparent;color:#cfeefb;border:1px solid rgba(255,255,255,0.06)}
  .top-right{display:flex;gap:14px;align-items:center}
  .screen{display:none;margin-top:18px;text-align:center}
  .screen.active{display:block}
  .flex{display:flex;gap:14px;margin-top:12px}
  .left{flex:0 0 340px}
  .right{flex:1}
  .dish-box{background:#081727;border-radius:8px;padding:12px;min-height:320px;display:flex;flex-direction:column;align-items:center}
  #dishImg{max-width:100%;max-height:240px;border-radius:6px;background:#071227}
  #map{height:520px;border-radius:8px}
  .hint{color:var(--muted);font-size:14px}
  .feedback{height:22px;margin-top:8px}
  .scoreboard p{margin:6px 0}
  @media (max-width:900px){.flex{flex-direction:column}.left{width:100%}}
</style>
</head>
<body>
  <div class="wrap card">
    <header>
      <div>
        <h1>GeoGame — Turkish Cuisine</h1>
        <div class="small">+5 correct / −1 wrong • 60 seconds • Click the city on the map</div>
      </div>
      <div class="top-right">
        <div class="small">Time: <strong id="timer">60</strong>s</div>
        <div class="small">Score: <strong id="score">0</strong></div>
        <button id="resetBtn" class="btn-ghost">Reset</button>
      </div>
    </header>

    <!-- START SCREEN (visible on load) -->
    <div id="startScreen" class="screen active">
      <h2>How to Play</h2>
      <p class="hint">A famous Turkish dish will be shown (name & picture). Click the city on the map that you think the dish belongs to.</p>
      <p class="hint">Scoring: <strong>+5</strong> for correct, <strong>−1</strong> for wrong. You have <strong>60 seconds</strong>.</p>
      <p class="hint">Tip: Dishes are regional — e.g. Baklava → Gaziantep, Boyoz → Izmir, Tantuni → Mersin.</p>
      <div style="margin-top:16px">
        <button id="startBtn" class="btn-primary">Start Game</button>
      </div>
    </div>

    <!-- GAME SCREEN -->
    <div id="gameScreen" class="screen">
      <div class="flex">
        <div class="left">
          <div class="dish-box">
            <img id="dishImg" alt="Dish image"/>
            <h3 id="dishName" style="margin-top:12px">Dish name</h3>
            <div id="feedback" class="feedback small"></div>
          </div>
        </div>
        <div class="right">
          <div id="map"></div>
        </div>
      </div>
    </div>

    <!-- SCOREBOARD (no 'game over' wording) -->
    <div id="scoreScreen" class="screen score-screen">
      <h2>Scoreboard</h2>
      <p>Your score: <strong id="finalScore">0</strong></p>
      <p class="small">Play again to improve your score.</p>
      <div style="margin-top:10px"><button id="playAgain" class="btn-primary">Play Again</button></div>
    </div>

    <footer style="margin-top:14px" class="small">If you add custom images, place them in an <code>images/</code> folder and name files sensibly.</footer>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
  // -----------------------
  // DATA (35 provinces)
  // -----------------------
  const CITIES = [
    {city:"Istanbul",lat:41.0082,lng:28.9784,dish:"İstanbul Spesiyalleri"},
    {city:"Izmir",lat:38.4237,lng:27.1428,dish:"Boyoz"},
    {city:"Ankara",lat:39.9334,lng:32.8597,dish:"Beypazarı Kurusu"},
    {city:"Antalya",lat:36.8841,lng:30.7056,dish:"Piyaz"},
    {city:"Bursa",lat:40.1955,lng:29.06,dish:"İskender"},
    {city:"Adana",lat:37.0017,lng:35.3289,dish:"Adana Kebap"},
    {city:"Gaziantep",lat:37.0662,lng:37.3833,dish:"Baklava"},
    {city:"Mersin",lat:36.8121,lng:34.6415,dish:"Tantuni"},
    {city:"Hatay",lat:36.2021,lng:36.1741,dish:"Künefe"},
    {city:"Konya",lat:37.8746,lng:32.4932,dish:"Etli Ekmek"},
    {city:"Kayseri",lat:38.7312,lng:35.4787,dish:"Mantı"},
    {city:"Samsun",lat:41.2867,lng:36.3333,dish:"Samsun Pide"},
    {city:"Trabzon",lat:41.0015,lng:39.7178,dish:"Akçaabat Köfte"},
    {city:"Rize",lat:41.0201,lng:40.5234,dish:"Laz Böreği"},
    {city:"Ordu",lat:40.9860,lng:37.8796,dish:"Hamsi"},
    {city:"Aydın",lat:37.8450,lng:27.8396,dish:"İncir Tatlısı"},
    {city:"Manisa",lat:38.6191,lng:27.4289,dish:"Mesir"},
    {city:"Bolu",lat:40.7395,lng:31.6116,dish:"Bolu Köftesi"},
    {city:"Çanakkale",lat:40.1553,lng:26.4142,dish:"Bozcaada Lezzetleri"},
    {city:"Çorum",lat:40.5488,lng:34.9536,dish:"İskilip Dolması"},
    {city:"Denizli",lat:37.7765,lng:29.0864,dish:"Kuzu Tandır"},
    {city:"Diyarbakır",lat:37.9144,lng:40.2306,dish:"Kaburga Dolması"},
    {city:"Elazığ",lat:38.6743,lng:39.2224,dish:"Harput Köftesi"},
    {city:"Erzurum",lat:39.9056,lng:41.2658,dish:"Cağ Kebabı"},
    {city:"Eskişehir",lat:39.7691,lng:30.5269,dish:"Çibörek"},
    {city:"K.Maraş",lat:37.5833,lng:36.9266,dish:"Maraş Dondurması"},
    {city:"Malatya",lat:38.3553,lng:38.3095,dish:"Kayısı Tatlısı"},
    {city:"Sivas",lat:39.7477,lng:37.0179,dish:"Kangal Sucuk"},
    {city:"Şanlıurfa",lat:37.1674,lng:38.7960,dish:"Lahmacun"},
    {city:"Uşak",lat:38.6820,lng:29.4082,dish:"Uşak Köftesi"},
    {city:"Van",lat:38.5010,lng:43.4167,dish:"Otlu Peynir"}
  ];

  // -----------------------
  // STATE
  // -----------------------
  let score = 0;
  let timeLeft = 60;
  let timerId = null;
  let currentIndex = null;
  let markers = [];

  // DOM refs
  const startScreen = document.getElementById('startScreen');
  const gameScreen  = document.getElementById('gameScreen');
  const scoreScreen = document.getElementById('scoreScreen');
  const startBtn    = document.getElementById('startBtn');
  const playAgain   = document.getElementById('playAgain');
  const resetBtn    = document.getElementById('resetBtn');
  const timerEl     = document.getElementById('timer');
  const scoreEl     = document.getElementById('score');
  const finalScore  = document.getElementById('finalScore');
  const dishImg     = document.getElementById('dishImg');
  const dishName    = document.getElementById('dishName');
  const feedback    = document.getElementById('feedback');

  // -----------------------
  // MAP init (but we will draw markers after game screen visible)
  // -----------------------
  const map = L.map('map', {preferCanvas:true, zoomControl:true}).setView([39,35],5);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution:'&copy; OpenStreetMap contributors',
    maxZoom:18
  }).addTo(map);

  // Draw a simplified Turkey outline (coarse polygon) for a clean white border.
  // NOTE: This is a simplified approximation for visual purposes only.
  const turkeyOutline = [
    [36.0, 26.0],[38.5,25.5],[40.4,26.0],[41.5,27.0],[42.8,26.5],[43.6,27.5],
    [42.9,29.0],[43.4,30.5],[42.8,32.5],[41.7,33.0],[40.6,34.5],[40.2,35.9],
    [40.8,37.2],[40.4,38.2],[39.7,39.6],[38.7,39.2],[37.9,38.9],[37.3,38.5],
    [36.9,37.6],[36.5,36.9],[36.2,36.2],[36.1,35.3],[35.8,34.6],[36.0,33.8],
    [35.6,33.0],[35.7,32.0],[35.9,31.0],[36.6,30.2],[37.5,30.1],[38.3,29.5],
    [39.1,28.9],[39.8,28.3],[40.3,27.6],[39.6,26.8],[38.6,26.2],[37.2,26.0],
    [36.0,26.0]
  ];

  L.polygon(turkeyOutline, {color:'#ffffff', weight:2, fill:false, opacity:0.9}).addTo(map);

  // helper: SVG placeholder (data URL)
  function placeholderSVG(text){
    const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='500'><rect width='100%' height='100%' fill='%230b1520'/><text x='50%' y='50%' fill='%23cfeff7' font-size='28' dominant-baseline='middle' text-anchor='middle'>${text}</text></svg>`;
    return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
  }

  // place markers (white fill + dark border, neat and unobtrusive)
  function placeMarkers(){
    // clear old
    markers.forEach(m=>map.removeLayer(m));
    markers = [];
    CITIES.forEach((c, idx)=>{
      const mk = L.circleMarker([c.lat, c.lng], {
        radius:8,
        color:'#2f3742',      // border dark
        weight:1.6,
        fillColor:'#ffffff',  // white fill
        fillOpacity:1
      }).addTo(map);
      mk.cityIndex = idx;
      mk.bindTooltip(c.city, {direction:'top', offset:[0,-8]});
      mk.on('click', ()=> onMarkerClick(idx));
      markers.push(mk);
    });
  }

  function onMarkerClick(idx){
    if (timeLeft <= 0) return;
    handleGuess(idx);
  }

  // core logic: evaluate guess and color markers
  function handleGuess(idx){
    if (currentIndex === null) return;
    // clicked marker
    if (idx === currentIndex){
      score += 5;
      feedback.style.color = '#7CFFBE';
      feedback.textContent = 'Correct! +5';
      // color the clicked marker green
      markers[idx].setStyle({color:'#2f3742', fillColor:'#28a745', fillOpacity:0.95});
    } else {
      score -= 1;
      feedback.style.color = '#ff9b9b';
      feedback.textContent = `Wrong! -1 (Correct: ${CITIES[currentIndex].city})`;
      // clicked marker red
      markers[idx].setStyle({color:'#2f3742', fillColor:'#e74c3c', fillOpacity:0.95});
      // highlight correct one green as teacher aid
      markers[currentIndex].setStyle({color:'#2f3742', fillColor:'#28a745', fillOpacity:0.95});
    }
    scoreEl.textContent = score;

    // after short delay, reset marker styles and next question (if time remains)
    setTimeout(()=>{
      markers.forEach(m=>{
        m.setStyle({color:'#2f3742', fillColor:'#ffffff', fillOpacity:1});
      });
      if (timeLeft > 0) nextQuestion();
    },900);
  }

  // pick next dish
  function nextQuestion(){
    currentIndex = Math.floor(Math.random() * CITIES.length);
    const item = CITIES[currentIndex];
    dishName.textContent = item.dish;
    dishImg.src = placeholderSVG(item.dish);
    feedback.textContent = '';
    // optionally pan a bit to show region
    map.setView([item.lat, item.lng], 6, {animate:true, duration:0.6});
  }

  // start game: show map, place markers after map is visible (fix Leaflet display issues)
  function startGame(){
    score = 0; timeLeft = 60;
    scoreEl.textContent = score;
    timerEl.textContent = timeLeft;

    // show game screen
    startScreen.classList.remove('active');
    scoreScreen.classList.remove('active');
    gameScreen.classList.add('active');

    // ensure map is resized when visible
    setTimeout(()=>{
      map.invalidateSize(true);
      placeMarkers();
      nextQuestion();
    }, 200);

    // start timer
    clearInterval(timerId);
    timerId = setInterval(()=>{
      timeLeft--;
      timerEl.textContent = timeLeft;
      if (timeLeft <= 0){
        endGame();
      }
    },1000);
  }

  function endGame(){
    clearInterval(timerId);
    gameScreen.classList.remove('active');
    scoreScreen.classList.add('active');
    finalScore.textContent = score;
  }

  // controls
  startBtn.addEventListener('click', startGame);
  playAgain.addEventListener('click', startGame);
  resetBtn.addEventListener('click', ()=>{
    clearInterval(timerId);
    score = 0; timeLeft = 60;
    scoreEl.textContent = score;
    timerEl.textContent = timeLeft;
    startScreen.classList.add('active');
    gameScreen.classList.remove('active');
    scoreScreen.classList.remove('active');
    map.setView([39,35],5);
    // remove markers until next start
    markers.forEach(m=>map.removeLayer(m));
    markers = [];
  });

  // render markers initially? don't until start to avoid Leaflet render bug
  // but draw outline already added above
  // map.invalidateSize on load just to be safe
  window.addEventListener('load', ()=> setTimeout(()=>map.invalidateSize(true),200));
  </script>
</body>
</html>
